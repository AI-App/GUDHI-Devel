language: cpp 
dist: xenial 
sudo: required 
git: 
 depth: 3
env:
 global: 
    - CGAL_VERSION='CGAL-4.13'
 matrix: 
# Only examples and associated tests
    - CMAKE_EXAMPLE='ON' CMAKE_TEST='OFF' CMAKE_UTILITIES='OFF' CMAKE_PYTHON='OFF' MAKE_TARGET='test'
# Only unitary tests
    - CMAKE_EXAMPLE='OFF' CMAKE_TEST='ON' CMAKE_UTILITIES='OFF' CMAKE_PYTHON='OFF' MAKE_TARGET='test'
# Only utilities and associated tests
    - CMAKE_EXAMPLE='OFF' CMAKE_TEST='OFF' CMAKE_UTILITIES='ON' CMAKE_PYTHON='OFF' MAKE_TARGET='test'
# Only doxygen documentation
    - CMAKE_EXAMPLE='OFF' CMAKE_TEST='OFF' CMAKE_UTILITIES='OFF' CMAKE_PYTHON='OFF' MAKE_TARGET='doxygen'
# Only Python, associated tests and sphinx documentation
    - CMAKE_EXAMPLE='OFF' CMAKE_TEST='OFF' CMAKE_UTILITIES='OFF' CMAKE_PYTHON='ON' MAKE_TARGET='test sphinx'
cache:
  directories:
    - $HOME/.cache/pip
    - $HOME/$CGAL_VERSION
compiler: gcc
addons:
  apt:
    packages:
      - cmake
      - graphviz 
      - doxygen
      - libboost-all-dev
      - libeigen3-dev
      - libgmp3-dev
      - libmpfr-dev
      - libtbb-dev
      - curl
      - python3
      - python3-pip
      - python3-pytest
      - python3-setuptools

# When installing through libcgal-dev apt, CMake Error at CGAL Exports.cmake The imported target "CGAL::CGAL Qt5" references the file
install: 
  - if [ ! -d "${CGAL_VERSION}" ]; then echo "Download https://github.com/CGAL/cgal/releases/download/releases%2F${CGAL_VERSION}/${CGAL_VERSION}.tar.xz"; fi
  - if [ ! -d "${CGAL_VERSION}" ]; curl -LO "https://github.com/CGAL/cgal/releases/download/releases%2F${CGAL_VERSION}/${CGAL_VERSION}.tar.xz"; fi
  - if [ ! -d "${CGAL_VERSION}" ]; tar xf ${CGAL_VERSION}.tar.xz; fi
  - cd ${CGAL_VERSION}
  - cmake -DCMAKE_BUILD_TYPE=Release -DCGAL_HEADER_ONLY=ON .
  - make all
  - cd ..
  - pip3 install --upgrade pip
  - pip3 install --user Cython sphinx sphinxcontrib-bibtex matplotlib numpy scipy
script: 
  - rm -rf build
  - mkdir -p build 
  - cd build 
  - echo "CGAL_DIR = ${HOME}/${CGAL_VERSION}"
  - cmake -DCGAL_DIR=${HOME}/${CGAL_VERSION} -DCMAKE_BUILD_TYPE=Release -DWITH_GUDHI_EXAMPLE=${CMAKE_EXAMPLE} -DWITH_GUDHI_TEST=${CMAKE_TEST} -DWITH_GUDHI_UTILITIES=${CMAKE_UTILITIES} -DWITH_GUDHI_PYTHON=${CMAKE_PYTHON} -DUSER_VERSION_DIR=version -DPython_ADDITIONAL_VERSIONS=3 .. 
  - make all ${MAKE_TARGET}
  - cd ..
notifications:
  email:
    on_success: change # default: always
    on_failure: always # default: always
